{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "Prowlarr Helm Chart Values",
  "type": "object",
  "additionalProperties": true,
  "properties": {
    "image": {
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "repository": {
          "type": "string",
          "minLength": 1,
          "description": "Container image repository"
        },
        "pullPolicy": {
          "type": "string",
          "enum": ["Always", "IfNotPresent", "Never"],
          "description": "Image pull policy"
        },
        "tag": {
          "type": "string",
          "description": "Image tag (defaults to chart appVersion when empty)"
        },
        "digest": {
          "type": "string",
          "description": "Optional image digest (sha256:...)"
        }
      },
      "required": ["repository", "pullPolicy"]
    },

    "service": {
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "type": {
          "type": "string",
          "enum": ["ClusterIP", "NodePort", "LoadBalancer", "ExternalName"],
          "description": "Kubernetes Service type"
        },
        "port": {
          "type": "integer",
          "minimum": 1,
          "maximum": 65535,
          "description": "Service port and container port"
        }
      },
      "required": ["type", "port"]
    },

    "ingress": {
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "enabled": {
          "type": "boolean",
          "default": false
        },
        "className": {
          "type": "string"
        },
        "annotations": {
          "type": "object",
          "additionalProperties": { "type": "string" },
          "description": "Ingress annotations"
        },
        "hosts": {
          "type": "array",
          "items": {
            "type": "object",
            "additionalProperties": false,
            "properties": {
              "host": { "type": "string", "minLength": 1 },
              "paths": {
                "type": "array",
                "items": {
                  "type": "object",
                  "additionalProperties": false,
                  "properties": {
                    "path": { "type": "string", "minLength": 1 },
                    "pathType": {
                      "type": "string",
                      "enum": ["ImplementationSpecific", "Prefix", "Exact"]
                    }
                  },
                  "required": ["path"]
                },
                "minItems": 1
              }
            },
            "required": ["host", "paths"]
          }
        },
        "tls": {
          "type": "array",
          "items": {
            "type": "object",
            "additionalProperties": false,
            "properties": {
              "secretName": { "type": "string", "minLength": 1 },
              "hosts": {
                "type": "array",
                "items": { "type": "string", "minLength": 1 },
                "minItems": 1
              }
            },
            "required": ["secretName", "hosts"]
          }
        }
      },
      "required": ["enabled", "annotations", "hosts", "tls"]
    },

    "env": {
      "type": "object",
      "additionalProperties": {
        "type": ["string", "number", "boolean"]
      },
      "description": "Environment variables for the container (values are rendered as strings)"
    },

    "probes": {
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "startup": { "$ref": "#/definitions/httpProbe" },
        "readiness": { "$ref": "#/definitions/httpProbe" },
        "liveness": { "$ref": "#/definitions/httpProbe" }
      },
      "required": ["startup", "readiness", "liveness"]
    },

    "persistence": {
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "enabled": {
          "type": "boolean",
          "default": true,
          "description": "Enable persistence for /config"
        },
        "existingClaim": {
          "type": "string",
          "description": "Use an existing PVC for /config"
        },
        "storageClass": {
          "type": "string",
          "description": "StorageClass for the /config PVC"
        },
        "accessMode": {
          "type": "string",
          "enum": ["ReadWriteOnce", "ReadOnlyMany", "ReadWriteMany", "ReadWriteOncePod"],
          "description": "Access mode for the /config PVC"
        },
        "size": {
          "type": "string",
          "pattern": "^[0-9]+(\\.[0-9]+)?(Ei|Pi|Ti|Gi|Mi|Ki|E|P|T|G|M|K)$",
          "description": "PVC size for /config (e.g., 1Gi)"
        },
        "backups": {
          "type": "object",
          "additionalProperties": false,
          "properties": {
            "enabled": {
              "type": "boolean",
              "default": false,
              "description": "Enable a separate persistence volume for /backups"
            },
            "existingClaim": {
              "type": "string",
              "description": "Use an existing PVC for /backups"
            },
            "storageClass": {
              "type": "string",
              "description": "StorageClass for the /backups PVC (falls back to persistence.storageClass when empty)"
            },
            "accessMode": {
              "type": "string",
              "enum": ["", "ReadWriteOnce", "ReadOnlyMany", "ReadWriteMany", "ReadWriteOncePod"],
              "description": "Access mode for /backups (falls back to persistence.accessMode when empty)"
            },
            "size": {
              "type": "string",
              "pattern": "^[0-9]+(\\.[0-9]+)?(Ei|Pi|Ti|Gi|Mi|Ki|E|P|T|G|M|K)$",
              "description": "PVC size for /backups (e.g., 5Gi)"
            }
          },
          "required": ["enabled", "existingClaim", "storageClass", "accessMode", "size"]
        },
        "additionalVolumes": {
          "type": "array",
          "items": {
            "type": "object"
          },
          "description": "Additional volumes (raw Kubernetes volume specs)"
        },
        "additionalMounts": {
          "type": "array",
          "items": {
            "type": "object"
          },
          "description": "Additional mounts (raw Kubernetes volumeMount specs)"
        }
      },
      "required": [
        "enabled",
        "existingClaim",
        "storageClass",
        "accessMode",
        "size",
        "backups",
        "additionalVolumes",
        "additionalMounts"
      ]
    },

    "apiKeySecret": {
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "enabled": { "type": "boolean", "default": false },
        "existingSecret": { "type": "string" },
        "name": { "type": "string" },
        "key": { "type": "string", "default": "apiKey" },
        "configXmlPath": { "type": "string", "default": "/config/config.xml" },
        "waitForConfigSeconds": { "type": "integer", "minimum": 0, "default": 300 },
        "failIfMissing": { "type": "boolean", "default": false },
        "rbac": {
          "type": "object",
          "additionalProperties": false,
          "properties": {
            "create": { "type": "boolean", "default": true }
          },
          "required": ["create"]
        },
        "job": {
          "type": "object",
          "additionalProperties": false,
          "properties": {
            "image": {
              "type": "object",
              "additionalProperties": false,
              "properties": {
                "repository": { "type": "string", "minLength": 1 },
                "tag": { "type": "string", "minLength": 1 },
                "pullPolicy": { "type": "string", "enum": ["Always", "IfNotPresent", "Never"] }
              },
              "required": ["repository", "tag"]
            },
            "ttlSecondsAfterFinished": { "type": "integer", "minimum": 0 },
            "backoffLimit": { "type": "integer", "minimum": 0 },
            "hookDeletePolicy": { "type": "string" }
          },
          "required": ["image", "hookDeletePolicy"]
        }
      },
      "required": ["enabled", "existingSecret", "name", "key", "configXmlPath", "waitForConfigSeconds", "failIfMissing", "rbac", "job"]
    }
  },

  "required": ["image", "service", "ingress", "env", "probes", "persistence", "apiKeySecret"],

  "definitions": {
    "httpProbe": {
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "enabled": {
          "type": "boolean"
        },
        "initialDelaySeconds": {
          "type": "integer",
          "minimum": 0
        },
        "periodSeconds": {
          "type": "integer",
          "minimum": 1
        },
        "timeoutSeconds": {
          "type": "integer",
          "minimum": 1
        },
        "failureThreshold": {
          "type": "integer",
          "minimum": 1
        },
        "successThreshold": {
          "type": "integer",
          "minimum": 1
        }
      },
      "required": ["enabled"]
    }
  }
}

