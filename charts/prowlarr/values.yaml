---
# Default values for prowlarr.
# This is a YAML-formatted file.
# Declare variables to be passed into your templates.

image:
  repository: "ghcr.io/linuxserver/prowlarr"
  pullPolicy: IfNotPresent
  # Overrides the image tag whose default is the chart appVersion.
  tag: ""
  digest: ""

imagePullSecrets: []
nameOverride: ""
fullnameOverride: ""

serviceAccount:
  # Specifies whether a service account should be created
  create: true
  # Annotations to add to the service account
  annotations: {}
  # The name of the service account to use.
  # If not set and create is true, a name is generated using the fullname template
  name: ""

podAnnotations: {}
podSecurityContext: {}
# fsGroup: 2000
securityContext: {}

service:
  type: ClusterIP
  port: 9696

ingress:
  enabled: false
  className: ""
  annotations: {}
  hosts:
    - host: prowlarr.local
      paths:
        - path: /
          pathType: ImplementationSpecific
  tls: []

resources: {}
nodeSelector: {}
tolerations: []
affinity: {}

env:
  PUID: "1000"
  PGID: "1000"
  TZ: "Europe/Berlin"
  UMASK: "022"
  UMASK_SET: "022"

# Probes that use Prowlarr's health endpoint.
probes:
  startup:
    enabled: true
    # For slow starts, increase failureThreshold or periodSeconds.
    periodSeconds: 10
    timeoutSeconds: 2
    failureThreshold: 30
  readiness:
    enabled: true
    periodSeconds: 10
    timeoutSeconds: 2
    failureThreshold: 3
  # Liveness is optional (enabled by default) in case you prefer to rely on startup/readiness only.
  liveness:
    enabled: true
    initialDelaySeconds: 120
    periodSeconds: 60
    timeoutSeconds: 20
    failureThreshold: 5

persistence:
  # /config volume
  enabled: true
  existingClaim: ""
  storageClass: ""
  accessMode: ReadWriteOnce
  size: 10Gi

  # Optional /backups volume
  backups:
    enabled: false
    existingClaim: ""
    storageClass: ""
    accessMode: ReadWriteOnce
    size: 5Gi

  # passthroughs
  additionalVolumes: []
  additionalMounts: []

# Optionally sync Prowlarr's API key (Config.ApiKey in /config/config.xml) into a Kubernetes Secret.
# NOTE: Helm cannot read the live config PVC during template rendering.
# This feature uses a post-install/post-upgrade hook Job to read config.xml from the PVC and upsert a Secret.
apiKeySecret:
  enabled: true

  # If set, chart won't create/sync a secret and will reference this existing secret.
  existingSecret: ""

  # Secret name to create/sync (defaults to "<release>-prowlarr-apikey").
  name: ""

  # Key name inside the secret's data.
  key: "apiKey"

  # Path to config.xml on the /config volume.
  configXmlPath: "/config/config.xml"

  # IMPORTANT: If your /config PVC uses accessMode ReadWriteOncePod, the sync job cannot mount it
  # while the main Prowlarr pod is running (Kubernetes will reject the second mount).
  # In that case either:
  # - switch persistence.accessMode to ReadWriteOnce (or ReadWriteMany if supported), OR
  # - set existingSecret and manage the key externally.
  waitForConfigSeconds: 30

  # If true, installation/upgrade fails when config.xml (or ApiKey) can't be read.
  failIfMissing: false

  # Job + RBAC details
  rbac:
    create: true

  job:
    image:
      repository: "bitnami/kubectl"
      tag: "1.30"
      pullPolicy: IfNotPresent

    ttlSecondsAfterFinished: 300
    backoffLimit: 1

    # Helm hook behavior
    hookDeletePolicy: "before-hook-creation,hook-succeeded"
...
